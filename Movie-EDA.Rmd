---
title: "Movie Revenue"
output: pdf_document
---

Packages used for analysis
```{r}
library(tidyverse)
library(caret)
library(Amelia)
library(stringr)
library(DataExplorer)
```

Read in the data
```{r, warning=FALSE}
movie_train <- read.csv("train.csv", stringsAsFactors = FALSE, na.strings = c("", NA))
movie_test <- read.csv("test.csv", stringsAsFactors = FALSE, na.strings = c("", NA))
head(movie_test)
movie_data <- bind_rows(movie_train, movie_test)
```


```{r}
str(movie_data) # Well some of these variables don't look like fun; belongs to collection, genres, production companies, production countries and so forth
```


```{r}
# Plots of numeric variables
ggplot(movie_data, aes(x=popularity, y = revenue)) + geom_point() + geom_smooth(method = "loess", se = FALSE) + xlim(0, 300)
ggplot(movie_data, aes(x=runtime, y = revenue)) + geom_point() + geom_smooth(method = "loess", se = FALSE)
ggplot(movie_data, aes(x=budget, y = revenue)) + geom_point() + geom_smooth(method = "loess", se = FALSE)

# Plot of how many values are missing
missmap(movie_data, col = c("red", "navyblue"))
plot_missing(movie_data)
```

Categorical variables
```{r}
# The categorical variables will be more difficult to deal with 
# Belongs to a collection
sum(is.na(movie_data$belongs_to_collection))
nrow(movie_data)
# It seems that most movies don't belong to a collection, so I'm going to create an indicator variable to specify if a movie belongs to a collection or not
movie_data <- movie_data %>% mutate(Collection = ifelse(is.na(belongs_to_collection), 0, 1))

# Original Language
sum(movie_data$original_language == "en")

# Most of the movies are English, so I'm going to add another indicator variable to specify if the original language was English or not
movie_data <- movie_data %>% mutate(English = ifelse(original_language == "en", 1, 0))

# For the others, we are likely going to have to use regular expressions to get information out of it I believe
```

```{r}
# Pulling out just the abbreviations
movie_data$spoken_languages <- sapply(movie_data$spoken_languages, function(x){unlist(str_extract_all(x, '(?<=\')[:lower:]{2}(?=\')'))})
```

```{r}
head(movie_data$spoken_languages)
```

```{r}
movie_data <- movie_data %>% mutate(SpEnglish = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'en'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpArabic = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'ar'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpKorean = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'ko'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpJapanese = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'ja'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpRussian = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'ru'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpFrench = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'fr'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpItalian = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'it'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpGerman = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'de'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpSpanish = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'es'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpPortugese = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'pt'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpHi = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'hi'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpZh = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'zh'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpLa = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'la'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpHe = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'he'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpQu = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'qu'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpTr = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'tr'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpTa = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'ta'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpTe = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'te'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpCn = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'cn'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpGd = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'gd'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpSv = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'sv'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpCs = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'cs'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpHu = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'hu'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpGa = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'ga'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpEl = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'el'))}), 1, 0))
movie_data <- movie_data %>% mutate(SpPl = ifelse(sapply(movie_data$spoken_languages, function(x){any(str_detect(x, 'pl'))}), 1, 0))
```

```{r}
# Ok this isn't the most efficient way but it works
# Created a variable for total number of languages spoken in a film (Num_Languages)
movie_data$Num_Languages <- movie_data$SpArabic + movie_data$SpCn + movie_data$SpCs + movie_data$SpEl + movie_data$SpEnglish + movie_data$SpFrench + movie_data$SpGa + movie_data$SpGd + movie_data$SpGerman + movie_data$SpHe + movie_data$SpHi + movie_data$SpHu + movie_data$SpItalian + movie_data$SpJapanese + movie_data$SpKorean + movie_data$SpLa + movie_data$SpPl + movie_data$SpPortugese + movie_data$SpQu + movie_data$SpRussian + movie_data$SpSpanish + movie_data$SpSv + movie_data$SpTa + movie_data$SpTe + movie_data$SpTr + movie_data$SpZh
```

